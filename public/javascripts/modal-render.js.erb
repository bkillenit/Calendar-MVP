$(document).ready(function(){ //beginning of ducment ready functions

});	//end of document ready

/* Function for  rendering a dynamic popup next to an event that has been clicked 
   by sending an AJAX GET request to the Show rails route with params being the id of 
   the event and the type of the event in regards to the users view.Destroy used instead 
   of toggle or hide on bootstrap elements because of issues with jQuery 1.8.3 integration with bootstrap. 
   Function done in jQuery so that it has direct control over the bootstrap popovers and tooltips rather 
   than relying on the html guessing */

function event_popover(event_div,id) {
  
  //initiates the controller data
  var controller_data = null;

  // Assigns a value to the controller data based on the event type for use by the type params in the AJAX request
  if ( $(event_div).hasClass("user-event") == true ) {
    	controller_data="user";
 	}
 	else if ( $(event_div).hasClass("unconfirmed-event" ) == true)  {
    	controller_data="unconfirmed";
 	}
 	else if ( $(event_div).hasClass("confirmed-event" ) == true ) {
    	controller_data="confirmed";
 	}
 	else if ( $(event_div).hasClass("merged-event") == true ) {
      controller_data="conflict";
 	}
  else {
      alert("event invalid");
  }

  // Failsafe to check if the event request is an event generated by our system with our model structure and not a hackers 
  if ( controller_data != null ) {

    // Initiates the visible popover variable and retrieves the id of the event
    var visible_popover = null;
    visible_popover = $('.show-popover').attr('id');

    // Destroys tooltip so that it wont be visible below the popover
    $(event_div).tooltip('destroy');

    /* Checks to see of you clicked on an event that already has a popup displayed, 
        and if not runs the AJAX request for filling the popover  */
    if (visible_popover == event_div.id) {

      // removes the show class from the event just clicked and destroys the events popover
      $(event_div).removeClass('show-popover');
      $(event_div).popover('destroy');


    } //end of visible_popover if 
    else {

      // removes show-popover class of the event that previously had a popover next to it and destroys that popover   
        $("#" + visible_popover).removeClass('show-popover');
        $("#" + visible_popover).popover('destroy');
      

      // adds show-popover class to the event you just clicked 
      $(event_div).addClass('show-popover');

      /* Sends an AJAX request to the show controller with a GET method and correct params 
      to get the HTML for the popover content*/ 
            $.ajax({ //beginning of AJAX request
                url: "/events/" + String(id),
                type: "GET",
                data: {type: controller_data},
                success: function(result){                      
                    $(event_div).popover({
                         placement: 'left',
                         html: true,
                         title: '',
                         content: result
                    });

                    //renders the popover with the content of the results from the AJAX request
                    $(event_div).popover('show');
                    
            
                },
                error: function(){
                    alert('Error occured');
                }
            }); //end of AJAX request

    } //end of else block 
  } // end of failsafe controller_data check
} // end of entire function    